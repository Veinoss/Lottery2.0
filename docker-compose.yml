services:
  ganache:
    image: trufflesuite/ganache-cli
    ports:
      - "8545:8545"
    command: ["--host", "0.0.0.0", "--accounts", "10", "--defaultBalanceEther", "1000"]

  truffle:
    image: node:18
    working_dir: /app
    volumes:
      - .:/app
    depends_on:
      - ganache
    environment:
      - NETWORK=development
      - HOST=http://ganache:8545
    command: sh -c "npm install -g truffle && truffle compile --config truffle-config.cjs && truffle migrate --network development --config truffle-config.cjs"

  react-app:
    image: node:18
    working_dir: /frontend
    ports:
      - "5173:5173"
    volumes:
      - .env:/frontend/.env
      - .:/frontend
      - /frontend/node_modules
    depends_on:
      - ganache
    command: |
      sh -c "
      npm install && npm run dev;     
      "
